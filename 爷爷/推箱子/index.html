<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çˆ·çˆ·æ¥å¸®å¿™ - å®Œç¾ç»ˆæç‰ˆ</title>
    <style>
        :root {
            --bg-color: #FFF3E0;
            --wall-color: #795548;
            --floor-color: #FFE0B2;
            --btn-color: #FF9800;
            --success-color: #2E7D32;
        }

        body {
            font-family: -apple-system, "Microsoft YaHei", sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation; 
            -webkit-user-select: none;
            user-select: none;
            min-height: 100vh;
        }

        header { text-align: center; margin-bottom: 10px; }
        h1 { font-size: 3.2rem; margin: 5px 0; color: #E65100; }
        .level-indicator { font-size: 2rem; color: #D84315; font-weight:bold; display: block; margin-top:5px;}

        #game-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 98%;
            max-width: 700px;
            box-sizing: border-box;
        }

        #grid {
            display: grid;
            gap: 2px;
            background-color: var(--wall-color);
            border: 6px solid var(--wall-color);
            border-radius: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .cell {
            width: 70px;
            height: 70px;
            background-color: var(--floor-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4.5rem;
            line-height: 1;
        }

        .wall { background-color: var(--wall-color); }
        .target { color: #D84315; font-weight: 900; font-size: 3.5rem;} 
        
        #message {
            min-height: 50px;
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--success-color);
            text-align: center;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(3, 90px);
            grid-template-rows: repeat(2, 90px);
            gap: 10px;
            margin-bottom: 20px;
        }

        .d-btn {
            background-color: var(--btn-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 3.5rem;
            cursor: pointer;
            box-shadow: 0 6px 0 #E65100;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .d-btn:active { transform: translateY(6px); box-shadow: none; }
        
        #btn-up { grid-column: 2; grid-row: 1; }
        #btn-left { grid-column: 1; grid-row: 2; }
        #btn-down { grid-column: 2; grid-row: 2; }
        #btn-right { grid-column: 3; grid-row: 2; }

        .action-btns { display: flex; gap: 15px; width: 100%; justify-content: center; }
        .big-btn {
            padding: 15px 25px;
            font-size: 1.6rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            color: white;
            flex: 1;
            max-width: 250px;
            box-shadow: 0 5px 0 rgba(0,0,0,0.3);
        }
        .reset-btn { background-color: #8D6E63; }
        .next-btn { background-color: var(--success-color); display: none; }

        @media (max-width: 450px) {
            .cell { width: 55px; height: 55px; font-size: 3.5rem; }
            .controls { grid-template-columns: repeat(3, 75px); grid-template-rows: repeat(2, 75px); }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ‘´ çˆ·çˆ·æ¥å¸®å¿™</h1>
    <span class="level-indicator">ç¬¬ <span id="level-num">1</span> / 10 å…³</span>
</header>

<div id="game-container">
    <div id="grid"></div>
    <div id="message"></div>

    <div class="controls">
        <button class="d-btn" id="btn-up" onclick="move(0, -1)">â†‘</button>
        <button class="d-btn" id="btn-left" onclick="move(-1, 0)">â†</button>
        <button class="d-btn" id="btn-down" onclick="move(0, 1)">â†“</button>
        <button class="d-btn" id="btn-right" onclick="move(1, 0)">â†’</button>
    </div>

    <div class="action-btns">
        <button class="big-btn reset-btn" onclick="resetLevel()">ğŸ”„ èµ°é”™äº†ï¼Œé‡æ¥</button>
        <button class="big-btn next-btn" id="next-btn" onclick="nextLevel()">ğŸ‰ ä¸‹ä¸€å…³</button>
    </div>
</div>

<script>
    const rawLevels = [
        // ç¬¬1å…³
        [
            [1,1,1,1,1,1,1],
            [1,4,0,2,0,3,1],
            [1,1,1,1,1,1,1]
        ],
        // ç¬¬2å…³
        [
            [1,1,1,1,1,1],
            [1,3,0,0,0,1],
            [1,0,2,4,0,1],
            [1,0,0,0,0,1],
            [1,1,1,1,1,1]
        ],
        // ç¬¬3å…³
        [
            [1,1,1,1,1,1,1],
            [1,3,0,0,0,3,1],
            [1,0,2,4,2,0,1],
            [1,0,0,0,0,0,1],
            [1,1,1,1,1,1,1]
        ],
        // ç¬¬4å…³ï¼šã€å·²ä¿®å¤ã€‘åŠ å®½äº†ï¼Œé˜²æ­¢æ¨åˆ°æ­»è§’
        [
            [1,1,1,1,1,1,1,1],
            [1,3,0,0,0,0,0,0],
            [1,1,1,1,1,0,0,0],
            [1,4,2,0,0,0,0,1],
            [1,1,1,1,1,0,0,1]
        ],
        // ç¬¬5å…³
        [
            [1,1,1,1,1,1,1],
            [1,3,0,1,0,3,1],
            [1,0,2,4,2,0,1],
            [1,0,0,1,0,0,1],
            [1,1,1,1,1,1,1]
        ],
        // ç¬¬6å…³
        [
            [1,1,1,1,1,1,1,1],
            [1,3,0,0,0,0,3,1],
            [1,0,0,2,4,2,0,1],
            [1,0,0,0,0,0,0,1],
            [1,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1]
        ],
        // ç¬¬7å…³
        [
            [1,1,1,1,1,1],
            [1,3,0,2,0,1],
            [1,1,0,4,0,1],
            [1,1,0,0,0,1],
            [1,3,0,2,0,1],
            [1,1,1,1,1,1]
        ],
        // ç¬¬8å…³
        [
            [1,1,1,1,1,1,1],
            [1,0,0,3,0,0,1],
            [1,0,0,0,0,0,1],
            [1,4,0,2,0,0,1],
            [1,0,0,2,0,0,1],
            [1,1,1,3,1,1,1],
            [1,1,1,1,1,1,1]
        ],
        // ç¬¬9å…³
        [
            [1,1,1,1,1,1,1],
            [1,3,0,2,0,4,1],
            [1,0,1,0,1,0,1],
            [1,0,0,2,0,0,1],
            [1,3,0,0,0,0,1],
            [1,1,1,1,1,1,1]
        ],
        // ç¬¬10å…³ï¼šå®Œç¾å¤§å›¢åœ†ä¿®æ­£ç‰ˆ
        [
            [1,1,1,1,1,1,1,1,1],
            [1,3,0,0,0,0,0,3,1],
            [1,0,2,0,0,0,2,0,1],
            [1,0,0,0,4,0,0,0,1],
            [1,0,2,0,0,0,2,0,1],
            [1,3,0,0,0,0,0,3,1],
            [1,1,1,1,1,1,1,1,1] 
        ]
    ];

    let currentLevelIdx = 0;
    let gridState = [];
    let playerPos = {x: 0, y: 0};
    let isLevelWon = false;

    function initGame() {
        if (currentLevelIdx >= rawLevels.length) {
            showFinalScreen();
            return;
        }
        isLevelWon = false;
        document.getElementById('level-num').innerText = currentLevelIdx + 1;
        document.getElementById('message').innerText = "";
        document.getElementById('next-btn').style.display = "none";
        enableControls(true);
        
        gridState = JSON.parse(JSON.stringify(rawLevels[currentLevelIdx]));
        findPlayer();
        drawGrid();
    }

    function findPlayer() {
        for(let y=0; y<gridState.length; y++) {
            for(let x=0; x<gridState[y].length; x++) {
                if(gridState[y][x] === 4) {
                    playerPos = {x, y};
                    return;
                }
            }
        }
    }

    function drawGrid() {
        const gridEl = document.getElementById('grid');
        gridEl.innerHTML = "";
        const rows = gridState.length;
        const cols = gridState[0].length;
        
        gridEl.style.gridTemplateColumns = `repeat(${cols}, auto)`;

        for(let y=0; y<rows; y++) {
            for(let x=0; x<cols; x++) {
                const cellVal = gridState[y][x];
                const cellEl = document.createElement('div');
                cellEl.className = "cell";

                if (cellVal === 1) cellEl.classList.add('wall');
                if (cellVal === 3) { cellEl.classList.add('target'); cellEl.innerText = "âŒ"; }
                if (cellVal === 2) cellEl.innerText = "ğŸ";
                if (cellVal === 4) cellEl.innerText = "ğŸ‘´";
                if (cellVal === 5) cellEl.innerText = "âœ…";

                gridEl.appendChild(cellEl);
            }
        }
    }

    function move(dx, dy) {
        if (isLevelWon) return;

        const nextX = playerPos.x + dx;
        const nextY = playerPos.y + dy;
        
        if (nextY < 0 || nextY >= gridState.length || nextX < 0 || nextX >= gridState[0].length) return;

        const nextVal = gridState[nextY][nextX];

        if (nextVal === 1) return; 

        if (nextVal === 0 || nextVal === 3) {
            updatePlayerPos(nextX, nextY);
        } 
        else if (nextVal === 2 || nextVal === 5) {
            const boxNextX = nextX + dx;
            const boxNextY = nextY + dy;
            if (boxNextY < 0 || boxNextY >= gridState.length || boxNextX < 0 || boxNextX >= gridState[0].length) return;
            
            const boxNextVal = gridState[boxNextY][boxNextX];

            if (boxNextVal === 0 || boxNextVal === 3) {
                gridState[boxNextY][boxNextX] = (boxNextVal === 3) ? 5 : 2;
                updatePlayerPos(nextX, nextY);
            }
        }
        
        drawGrid();
        checkWin();
    }

    function updatePlayerPos(nextX, nextY) {
        const currentCellBaseType = rawLevels[currentLevelIdx][playerPos.y][playerPos.x];
        gridState[playerPos.y][playerPos.x] = (currentCellBaseType === 3) ? 3 : 0;

        playerPos.x = nextX;
        playerPos.y = nextY;
        gridState[nextY][nextX] = 4;
    }

    function checkWin() {
        let hasUnfinishedBox = false;
        for(let y=0; y<gridState.length; y++) {
            for(let x=0; x<gridState[y].length; x++) {
                if(gridState[y][x] === 2) {
                    hasUnfinishedBox = true;
                    break;
                }
            }
        }

        if (!hasUnfinishedBox) {
            isLevelWon = true;
            document.getElementById('message').innerText = "ğŸ‰ æˆåŠŸå•¦ï¼çˆ·çˆ·çœŸæ£’ï¼";
            try { new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3').play(); } catch(e){}
            document.getElementById('next-btn').style.display = "inline-block";
            enableControls(false);
        }
    }

    function resetLevel() {
        initGame();
    }

    function nextLevel() {
        currentLevelIdx++;
        initGame();
    }

    function enableControls(enable) {
        const btns = document.querySelectorAll('.d-btn');
        btns.forEach(b => b.disabled = !enable);
        document.querySelector('.reset-btn').disabled = isLevelWon && currentLevelIdx >= rawLevels.length;
    }

    function showFinalScreen() {
        document.getElementById('game-container').innerHTML = `
            <div style="font-size:6rem;">ğŸŠğŸğŸ‘´ğŸ‰</div>
            <h1 style="color:#E65100; font-size:3.5rem; margin:20px 0;">10å…³å…¨é€šï¼</h1>
            <p style="font-size:2.2rem; margin: 30px 0; line-height:1.5;">çˆ·çˆ·å¤ªå‰å®³äº†ï¼<br>æ‰€æœ‰ç¤¼ç‰©éƒ½é€åˆ°äº†ï¼<br>åå…¨åç¾ï¼</p>
            <button class="big-btn reset-btn" style="background-color:var(--success-color); max-width:300px;" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
        `;
    }

    initGame();
</script>
</body>
</html>