<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çˆ·çˆ·çš„æˆè¯­æ¥é¾™ - éšæœºæŒ‘æˆ˜ç‰ˆ</title>
    <style>
        /* ä¿æŒåŸæœ‰çš„æŠ¤çœ¼å¤§å­—ä½“æ ·å¼ */
        body {
            font-family: -apple-system, "Microsoft YaHei", "Heiti SC", sans-serif;
            background-color: #FEF9E7;
            color: #4A4A4A;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; text-align: center;
            -webkit-user-select: none; user-select: none;
        }

        header {
            margin-bottom: 20px; border-bottom: 3px solid #D35400; padding-bottom: 10px;
            width: 100%; max-width: 600px;
        }
        h1 { font-size: 2.8rem; color: #C0392B; margin: 10px 0; }
        p.subtitle { font-size: 1.5rem; color: #7F8C8D; font-weight: bold; }

        #game-container {
            background-color: #FFF; border-radius: 25px; padding: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            width: 95%; max-width: 650px; margin-bottom: 20px;
        }

        .progress { font-size: 1.5rem; margin-bottom: 30px; color: #D35400; font-weight: bold; }
        
        .idiom-box { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; }
        .char-block {
            width: 80px; height: 80px; background-color: #FAD7A0; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 3.5rem; font-weight: bold; color: #333; border: 3px solid #E67E22;
        }
        .char-block.empty { background-color: #ECF0F1; border: 3px dashed #95A5A6; color: #C0392B; }

        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; }
        button.option-btn {
            background-color: #27AE60; color: white; border: none; padding: 25px;
            font-size: 2.5rem; border-radius: 20px; cursor: pointer;
            transition: transform 0.1s; box-shadow: 0 6px 0 #1E8449;
        }
        button.option-btn:active { transform: translateY(6px); box-shadow: none; }

        #message {
            font-size: 2rem; margin-top: 30px; height: 60px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
        }
        .correct { color: #27AE60; } .wrong { color: #C0392B; }

        #next-btn {
            margin-top: 10px; padding: 20px 50px; font-size: 2rem;
            background-color: #D35400; color: white; border: none;
            border-radius: 60px; cursor: pointer; display: none;
            box-shadow: 0 8px 0 #A04000;
        }
        #next-btn:active { transform: translateY(8px); box-shadow: none; }

        @media (max-width: 600px) {
            h1 { font-size: 2.2rem; }
            .char-block { width: 60px; height: 60px; font-size: 2.5rem; }
            button.option-btn { font-size: 2rem; padding: 15px; }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ… çˆ·çˆ·çš„æˆè¯­æ¸¸æˆ</h1>
    <p class="subtitle">æ¯æ¬¡éšæœº 10 é¢˜ï¼Œå¤©å¤©ä¸é‡æ ·ï¼</p>
</header>

<div id="game-container">
    <div class="progress">ç¬¬ <span id="current-level-num">1</span> é¢˜ / å…± 10 é¢˜</div>
    
    <div class="idiom-box" id="idiom-display">
        <div style="font-size:1.5rem; color:#888;">æ­£åœ¨åŠ è½½æˆè¯­åº“...</div>
    </div>

    <div class="options-grid" id="options-area">
        </div>

    <div id="message"></div>

    <button id="next-btn" onclick="nextLevel()">ä¸‹ä¸€é¢˜ â”</button>
</div>

<script>
    let idiomDatabase = []; // è¿™æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œç­‰å¾…ä» JSON è¯»å–
    let currentLevels = [];
    let currentIdx = 0;
    let isAnswered = false;

    // --- ç¬¬ä¸€æ­¥ï¼šè¯»å– JSON æ–‡ä»¶ ---
    async function loadIdioms() {
        try {
            // è¿™é‡Œå»è¯»å–åŒç›®å½•ä¸‹çš„ idioms.json æ–‡ä»¶
            const response = await fetch('idioms.json');
            if (!response.ok) {
                throw new Error("ç½‘ç»œå“åº”ä¸æ­£å¸¸");
            }
            idiomDatabase = await response.json();
            
            // è¯»å–æˆåŠŸåï¼Œå¼€å§‹æ¸¸æˆ
            initGameSet();
        } catch (error) {
            console.error("åŠ è½½è¯åº“å¤±è´¥:", error);
            document.getElementById('idiom-display').innerHTML = 
                `<div style="color:red; font-size:1.5rem;">åŠ è½½è¯åº“å¤±è´¥äº†<br>è¯·ç¡®ä¿ idioms.json æ–‡ä»¶å­˜åœ¨</div>`;
        }
    }

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šæ´—ç‰Œç®—æ³• ---
    function getRandomLevels(num) {
        let pool = [...idiomDatabase];
        pool.sort(() => Math.random() - 0.5);
        return pool.slice(0, num);
    }

    function initGameSet() {
        currentLevels = getRandomLevels(10); // éšæœºå–10ä¸ª
        currentIdx = 0;
        renderLevel();
    }

    function renderLevel() {
        if (currentIdx >= currentLevels.length) {
            showEndScreen();
            return;
        }
        
        isAnswered = false;
        document.getElementById('current-level-num').innerText = currentIdx + 1;
        document.getElementById('message').innerText = "è¯·ç‚¹å‡»ä¸‹æ–¹æ–‡å­—å¡«ç©º";
        document.getElementById('message').className = "";
        document.getElementById('next-btn').style.display = "none";
        
        const levelData = currentLevels[currentIdx];
        const idiomDisplay = document.getElementById('idiom-display');
        const optionsArea = document.getElementById('options-area');

        // æ¸²æŸ“æˆè¯­
        idiomDisplay.innerHTML = "";
        for (let i = 0; i < 4; i++) {
            const div = document.createElement('div');
            div.className = "char-block";
            if (i === levelData.answerIndex) {
                div.className += " empty";
                div.innerText = "?";
                div.id = "target-char";
            } else {
                div.innerText = levelData.text[i];
            }
            idiomDisplay.appendChild(div);
        }

        // æ¸²æŸ“é€‰é¡¹
        optionsArea.innerHTML = "";
        let currentOptions = [...levelData.options]; 
        currentOptions.sort(() => Math.random() - 0.5);

        currentOptions.forEach(char => {
            const btn = document.createElement('button');
            btn.className = "option-btn";
            btn.innerText = char;
            btn.onclick = () => checkAnswer(char, levelData.text[levelData.answerIndex], btn);
            optionsArea.appendChild(btn);
        });
    }

    function checkAnswer(selectedChar, correctChar, btnElement) {
        if (isAnswered) return;

        const messageEl = document.getElementById('message');
        const targetEl = document.getElementById('target-char');

        if (selectedChar === correctChar) {
            isAnswered = true;
            targetEl.innerText = correctChar;
            targetEl.style.backgroundColor = "#27AE60";
            targetEl.style.color = "#FFF";
            targetEl.style.border = "3px solid #27AE60";
            
            messageEl.innerText = "ğŸ‰ ç­”å¯¹äº†ï¼çˆ·çˆ·çœŸæ£’ï¼";
            messageEl.className = "correct";
            try { new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3').play(); } catch(e){}

            document.getElementById('next-btn').style.display = "inline-block";
            
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.style.opacity = "0.5");
            btnElement.style.opacity = "1";
            btnElement.style.backgroundColor = "#27AE60";
        } else {
            messageEl.innerText = "ğŸ¤” å¥½åƒä¸å¯¹å“¦ï¼Œå†è¯•è¯•ï¼Ÿ";
            messageEl.className = "wrong";
            btnElement.style.backgroundColor = "#95A5A6";
            btnElement.disabled = true;
        }
    }

    function nextLevel() {
        currentIdx++;
        renderLevel();
    }

    function showEndScreen() {
        const container = document.getElementById('game-container');
        container.innerHTML = `
            <div style="font-size:6rem;">ğŸ†ğŸ‰</div>
            <h2 style="color:#C0392B; font-size:3rem; margin:10px 0;">æŒ‘æˆ˜æˆåŠŸï¼</h2>
            <p style="font-size:1.8rem;">çˆ·çˆ·ä»Šå¤©çš„è„‘åŠ›ä¹Ÿæ˜¯æ£’æ£’çš„ï¼</p>
            <p style="font-size:1.5rem; color:#7F8C8D;">10é“é¢˜å…¨éƒ¨ç­”å¯¹</p>
            <button id="next-btn" onclick="location.reload()" style="display:inline-block; margin-top:30px; padding:25px 60px;">å†æ¥ä¸€ç»„æ–°çš„</button>
        `;
    }

    // å¯åŠ¨ï¼ˆä»åŠ è½½ JSON å¼€å§‹ï¼‰
    loadIdioms();

</script>

</body>
</html>