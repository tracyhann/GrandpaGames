<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çˆ·çˆ· VS çŒ´å­ï¼šå¹²æ¯å¤§èµ›</title>
    <style>
        :root {
            --bg-color: #FFF3E0; /* æš–è‰²èƒŒæ™¯ */
            --bowl-bg: rgba(255,255,255,0.8);
            --liquid-color: #FFB74D; /* åƒé»„é…’æˆ–èŒ¶çš„é¢œè‰² */
            --monkey-liquid: #A1887F; /* çŒ´å­å–çš„ç¨å¾®æµ‘æµŠç‚¹ */
        }

        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            height: 60px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            flex-shrink: 0;
            z-index: 10;
        }
        h1 { margin: 0; font-size: 2rem; color: #E65100; }

        /* ä¸»èˆå° */
        #stage {
            flex: 1;
            display: flex;
            padding: 10px;
            gap: 10px;
            position: relative;
        }

        /* é€‰æ‰‹å¡ç‰‡ */
        .player-card {
            flex: 1;
            background: #fff;
            border-radius: 20px;
            border: 5px solid #8D6E63;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        #grandpa-card { border-color: #E64A19; }
        #monkey-card { border-color: #5D4037; background: #EFEBE9; }

        .avatar { font-size: 5rem; margin-top: 10px; z-index: 2; }
        .name { font-size: 2rem; font-weight: bold; color: #333; z-index: 2; margin-bottom: 5px;}

        /* --- é‚£ä¸ªå¤§ç¢— --- */
        .bowl-container {
            width: 140px;
            height: 140px;
            border: 8px solid #333;
            border-radius: 10px 10px 60px 60px; /* ç¢—çš„å½¢çŠ¶ */
            position: relative;
            margin-top: auto;
            margin-bottom: 20px;
            background: var(--bowl-bg);
            overflow: hidden; /* æ¶²ä½“ä¸èƒ½æº¢å‡º */
            z-index: 1;
        }

        /* ç¢—é‡Œçš„æ¶²ä½“ */
        .liquid {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            height: 0%; /* åˆå§‹é«˜åº¦ï¼ŒJSæ§åˆ¶ */
            transition: height 0.2s linear;
        }
        #g-liquid { background-color: var(--liquid-color); }
        #m-liquid { background-color: var(--monkey-liquid); }

        /* æ¶²ä½“è¡¨é¢çš„æ³¢æµªçº¿æ¡è£…é¥° */
        .liquid::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: rgba(255,255,255,0.5);
        }

        /* è¿›åº¦æ–‡å­— */
        .progress-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #555;
            margin-bottom: 10px;
        }
        .big-count { font-size: 2.5rem; color: #E65100; }

        /* --- çˆ·çˆ·çš„å¤§æŒ‰é’® (è¦†ç›–åœ¨å·¦ä¾§) --- */
        #tap-zone {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; cursor: pointer;
            /* ç‚¹å‡»åé¦ˆ */
            background: rgba(255,255,255,0);
        }
        #tap-zone:active { background: rgba(255,255,255,0.2); }

        /* æç¤ºæ–‡å­— */
        .hint-text {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 2.5rem; font-weight: 900; color: #D84315;
            pointer-events: none; opacity: 0.6;
            text-align: center;
        }

        /* --- çŠ¶æ€ç‰¹æ•ˆ (å’•å˜Ÿ/å‘›åˆ°) --- */
        .status-bubble {
            position: absolute; top: 30%;
            font-size: 2rem; font-weight: bold;
            animation: floatUp 0.8s forwards;
            pointer-events: none; z-index: 20;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }

        .choke-mask {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,0,0,0.3);
            display: none;
            align-items: center; justify-content: center;
            font-size: 3rem; color: white; font-weight: bold;
            z-index: 5;
            text-shadow: 2px 2px 0 red;
        }

        /* --- åº•éƒ¨æŒ‰é’® --- */
        .controls {
            padding: 15px;
            background: #fff;
            display: flex;
            justify-content: center;
            flex-shrink: 0;
        }
        #start-btn {
            width: 100%; max-width: 400px;
            padding: 15px 0;
            font-size: 2.5rem; border-radius: 50px; border: none;
            background: #FF6F00; color: white; font-weight: bold;
            box-shadow: 0 6px 0 #E65100; cursor: pointer;
        }
        #start-btn:active { transform: translateY(6px); box-shadow: none; }
        #start-btn:disabled { background: #ccc; box-shadow: none; color: #666; }

        /* --- ç»“æœå¼¹çª— --- */
        #modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal-box {
            background: white; width: 85%; max-width: 500px;
            padding: 30px; border-radius: 30px; text-align: center;
            border: 8px solid #FFCA28;
            animation: popIn 0.5s;
        }
        @keyframes popIn { from{transform:scale(0.5)} to{transform:scale(1)} }

        .monkey-cry { font-size: 8rem; position: relative; display: inline-block; margin: 20px 0;}
        .tear {
            position: absolute; color: #2196F3; font-size: 3rem;
            animation: tearDrop 1s infinite;
        }
        .t1 { left: 0; top: 40px; }
        .t2 { right: 0; top: 50px; animation-delay: 0.3s; }
        @keyframes tearDrop { 100% { transform:translateY(60px); opacity:0; } }

    </style>
</head>
<body>

<div class="top-bar">
    <h1>ğŸ¶ è±ªçˆ½å¹²æ¯å¤§èµ›</h1>
</div>

<div id="stage">
    <div class="player-card" id="grandpa-card">
        <div id="tap-zone" onclick="grandpaDrink()">
            <div class="hint-text" id="g-hint">ç‚¹è¿™é‡Œ<br>å–ï¼</div>
        </div>
        <div class="avatar">ğŸ‘´</div>
        <div class="name">çˆ·çˆ·</div>
        
        <div class="progress-text">è¿˜å‰© <span class="big-count" id="g-count">3</span> ç¢—</div>

        <div class="bowl-container">
            <div class="liquid" id="g-liquid"></div>
        </div>
    </div>

    <div class="player-card" id="monkey-card">
        <div class="avatar">ğŸµ</div>
        <div class="name">ç¬¨çŒ´å­</div>
        
        <div class="progress-text">è¿˜å‰© <span class="big-count" id="m-count">3</span> ç¢—</div>

        <div class="bowl-container">
            <div class="liquid" id="m-liquid"></div>
            <div class="choke-mask" id="m-choke">
                å’³å’³!<br>å‘›ç€äº†
            </div>
        </div>
    </div>
</div>

<div class="controls">
    <button id="start-btn" onclick="startGame()">ğŸ”¥ å¼€å§‹æ–Ÿé…’ï¼</button>
</div>

<div id="modal">
    <div class="modal-box">
        <h2 style="font-size:3rem; color:#E65100; margin:0;">æ¯”èµ›ç»“æŸ</h2>
        
        <div id="win-view" style="display:none;">
            <div class="monkey-cry">
                ğŸµ
                <span class="tear t1">ğŸ’§</span>
                <span class="tear t2">ğŸ’§</span>
            </div>
            <p style="font-size:2.5rem; font-weight:bold; color:#333;">çˆ·çˆ·æµ·é‡ï¼<br>çŒ´å­å–è¶´ä¸‹äº†ï¼</p>
        </div>

        <div id="lose-view" style="display:none;">
            <div style="font-size:6rem; margin:20px 0;">ğŸµğŸº</div>
            <p style="font-size:2rem;">çŒ´å­è¿™æ¬¡è¿æ°”å¥½...<br>å†æ¥ä¸€å±€ï¼</p>
        </div>

        <button id="start-btn" style="background:#2E7D32; margin-top:20px; font-size:2rem;" onclick="closeModal()">å†å¹²ä¸€ç¢—ï¼</button>
    </div>
</div>

<script>
    // æ¸¸æˆé…ç½®
    const TOTAL_BOWLS = 3;   // æ€»å…±å–3ç¢—
    const TAPS_PER_BOWL = 6; // æ¯ç¢—éœ€è¦ç‚¹6ä¸‹æ‰èƒ½å–å®Œ
    
    // çŠ¶æ€
    let gBowls = TOTAL_BOWLS;
    let mBowls = TOTAL_BOWLS;
    let gSips = 0; // å½“å‰è¿™ç¢—å–äº†å¤šå°‘å£
    let mSips = 0;
    
    let isPlaying = false;
    let monkeyTimer = null;
    let monkeyIsChoking = false;

    // åˆå§‹åŒ–
    function resetGame() {
        gBowls = TOTAL_BOWLS;
        mBowls = TOTAL_BOWLS;
        gSips = 0;
        mSips = 0;
        
        updateDisplay();
        document.getElementById('g-hint').style.display = 'block';
        document.getElementById('m-choke').style.display = 'none';
        
        // åˆå§‹æ¶²ä½“æ˜¯æ»¡çš„
        document.getElementById('g-liquid').style.height = '100%';
        document.getElementById('m-liquid').style.height = '100%';
    }

    function updateDisplay() {
        document.getElementById('g-count').innerText = gBowls;
        document.getElementById('m-count').innerText = mBowls;
        
        // è®¡ç®—æ¶²ä½“é«˜åº¦ç™¾åˆ†æ¯” (åå‘ï¼Œå–å¾—è¶Šå¤šé«˜åº¦è¶Šä½)
        // æ³¨æ„ï¼šè¿™é‡Œé€»è¾‘æ˜¯ï¼Œsipsè¶Šå¤šï¼Œæ¶²ä½“è¶Šå°‘
        // åˆå§‹ sips=0, height=100%. sips=TAPS, height=0%
        let gHeight = 100 - (gSips / TAPS_PER_BOWL * 100);
        let mHeight = 100 - (mSips / TAPS_PER_BOWL * 100);
        
        document.getElementById('g-liquid').style.height = `${gHeight}%`;
        document.getElementById('m-liquid').style.height = `${mHeight}%`;
    }

    // å¼€å§‹
    function startGame() {
        if (isPlaying) return;
        resetGame();
        isPlaying = true;
        document.getElementById('start-btn').disabled = true;
        document.getElementById('start-btn').innerText = "æ­£åœ¨æ¯”èµ›...";
        document.getElementById('g-hint').style.display = 'none';
        
        startMonkeyAI();
    }

    // çˆ·çˆ·å–
    function grandpaDrink() {
        if (!isPlaying) return;
        if (gBowls <= 0) return;

        gSips++;
        showEffect("å’•å˜Ÿ", "grandpa-card", "#E65100");
        
        // å–å®Œä¸€ç¢—
        if (gSips >= TAPS_PER_BOWL) {
            finishBowl('g');
        } else {
            updateDisplay();
        }
    }

    function finishBowl(who) {
        if (who === 'g') {
            gBowls--;
            gSips = 0;
            showEffect("å“ˆ~ çˆ½!", "grandpa-card", "#D84315");
            // ç®€å•éœ‡åŠ¨åé¦ˆ
            if(navigator.vibrate) navigator.vibrate(50);
        } else {
            mBowls--;
            mSips = 0;
            showEffect("å±å±!", "monkey-card", "#5D4037");
        }
        
        updateDisplay();
        
        // é‡æ–°å€’é…’åŠ¨ç”»ï¼ˆç¬é—´æ»¡ä¸Šï¼‰
        if ((who === 'g' && gBowls > 0) || (who === 'm' && mBowls > 0)) {
            setTimeout(() => {
                if(who === 'g') document.getElementById('g-liquid').style.height = '100%';
                else document.getElementById('m-liquid').style.height = '100%';
            }, 100);
        }

        checkWin();
    }

    // ç¬¨çŒ´å­AI
    function startMonkeyAI() {
        if (monkeyTimer) clearTimeout(monkeyTimer);
        
        // çŒ´å­å–æ°´çš„é—´éš”ï¼šéšæœº
        let delay = Math.random() * 500 + 400; // 0.4s - 0.9s å–ä¸€å£

        monkeyTimer = setTimeout(() => {
            if (!isPlaying) return;

            // å¦‚æœçŒ´å­æ­£åœ¨å‘›æ°´ï¼Œå°±ä¸èƒ½å–ï¼Œç­‰ä¸€ä¼š
            if (monkeyIsChoking) {
                // å‘›æ°´æŒç»­ 2ç§’
                setTimeout(() => {
                    monkeyIsChoking = false;
                    document.getElementById('m-choke').style.display = 'none';
                    startMonkeyAI(); // æ¢å¤å–æ°´
                }, 2000);
                return;
            }

            // çŒ´å­å–ä¸€å£
            mSips++;
            // 20% æ¦‚ç‡å‘›åˆ°
            if (Math.random() < 0.2) {
                monkeyIsChoking = true;
                document.getElementById('m-choke').style.display = 'flex';
                // å‘›åˆ°è¿™å£ä¸ç®—ï¼Œæˆ–è€…æš‚åœ
            } else {
                showEffect("å’•å˜Ÿ", "monkey-card", "#795548");
                if (mSips >= TAPS_PER_BOWL) {
                    finishBowl('m');
                } else {
                    updateDisplay();
                }
            }

            // æ²¡èµ¢å°±ç»§ç»­
            if (mBowls > 0 && !monkeyIsChoking) {
                startMonkeyAI();
            } else if (monkeyIsChoking) {
                // å¦‚æœå‘›åˆ°äº†ï¼Œé‡æ–°è§¦å‘ä»¥ä¾¿è¿›å…¥ä¸Šé¢çš„å‘›æ°´ç­‰å¾…é€»è¾‘
                startMonkeyAI();
            }

        }, delay);
    }

    // é£˜å­—ç‰¹æ•ˆ
    function showEffect(text, cardId, color) {
        const card = document.getElementById(cardId);
        const el = document.createElement('div');
        el.className = 'status-bubble';
        el.innerText = text;
        el.style.color = color;
        // éšæœºä½ç½®
        el.style.left = (20 + Math.random() * 60) + '%';
        card.appendChild(el);
        setTimeout(() => el.remove(), 800);
    }

    function checkWin() {
        if (gBowls <= 0) endGame('grandpa');
        else if (mBowls <= 0) endGame('monkey');
    }

    function endGame(winner) {
        isPlaying = false;
        clearTimeout(monkeyTimer);
        document.getElementById('start-btn').disabled = false;
        document.getElementById('start-btn').innerText = "ğŸ”¥ å†æ¥ä¸€å±€";
        
        const modal = document.getElementById('modal');
        const winView = document.getElementById('win-view');
        const loseView = document.getElementById('lose-view');
        
        modal.style.display = 'flex';
        
        if (winner === 'grandpa') {
            winView.style.display = 'block';
            loseView.style.display = 'none';
            try { new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3').play(); } catch(e){}
        } else {
            winView.style.display = 'none';
            loseView.style.display = 'block';
        }
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
        resetGame();
    }

    // å¯åŠ¨
    resetGame();

</script>
</body>
</html>